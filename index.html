<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Instant feint Timings</title>
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #0f1621;
      --panel2: #0c121b;
      --text: #e7eef8;
      --muted: #9fb0c7;
      --border: rgba(231, 238, 248, 0.14);
      --border2: rgba(231, 238, 248, 0.22);
      --accent: #7aa2ff;
      --good: #56d364;
      --bad: #ff6b6b;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      line-height: 1.35;
      background: radial-gradient(1200px 600px at 50% -10%, rgba(122,162,255,0.18), transparent 60%),
                  radial-gradient(900px 500px at 10% 10%, rgba(86,211,100,0.10), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 28px 18px;
    }

    /* Center the entire app */
    .app {
      width: min(760px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 18px 70px rgba(0,0,0,0.55);
      backdrop-filter: blur(6px);
    }

    h1 {
      margin: 0 0 10px;
      font-size: 22px;
      letter-spacing: 0.2px;
    }

    .hint {
      color: var(--muted);
      margin-top: 6px;
      font-size: 13px;
    }

    .box {
      width: 100%;
      height: 260px;
      border: 2px dashed var(--border2);
      border-radius: 14px;
      display: grid;
      place-items: center;
      user-select: none;
      margin-top: 14px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      outline: none;
    }

    .status { font-size: 18px; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-top: 14px;
    }

    button {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border2);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      cursor: pointer;
      transition: transform 0.05s ease, background 0.15s ease, border-color 0.15s ease;
    }
    button:hover {
      background: rgba(255,255,255,0.07);
      border-color: rgba(122,162,255,0.45);
    }
    button:active { transform: translateY(1px); }

    /* Bigger, more important badges */
    .metric {
      display: inline-flex;
      align-items: baseline;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid var(--border2);
      background: rgba(122,162,255,0.10);
      box-shadow: inset 0 0 0 1px rgba(122,162,255,0.08);
      white-space: nowrap;
    }
    .metric .label {
      color: var(--muted);
      font-size: 12px;
      letter-spacing: 0.2px;
      text-transform: uppercase;
    }
    .metric .value {
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
      font-variant-numeric: tabular-nums;
    }

    .metric.last {
      background: rgba(86,211,100,0.10);
      box-shadow: inset 0 0 0 1px rgba(86,211,100,0.10);
    }

    /* Fixed-height table region so the UI doesn't jump when rows change */
    .tableWrap {
      margin-top: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      overflow: hidden;

      /* Reserve space (tweak if you want bigger/smaller) */
      height: 360px;
      display: flex;
      flex-direction: column;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    thead th {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.2px;
      color: var(--muted);
      background: rgba(255,255,255,0.04);
      border-bottom: 1px solid var(--border);
      padding: 10px 10px;
      text-align: right;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* scrollable body */
    .tbodyScroll {
      overflow: auto;
      flex: 1;
    }

    tbody td {
      border-bottom: 1px solid rgba(231,238,248,0.08);
      padding: 10px 10px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    th:first-child, td:first-child { text-align: left; }

    tbody tr:hover {
      background: rgba(255,255,255,0.03);
    }

    .footer-note {
      padding: 10px 12px;
      font-size: 12px;
      color: var(--muted);
      border-top: 1px solid rgba(231,238,248,0.08);
      background: rgba(255,255,255,0.02);
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Instant feint Timings</h1>

    <div class="hint">Tip: Use the box area so the browser keeps focus. Right-click menu is disabled inside the box.</div>

    <div id="box" class="box" tabindex="0" role="application" aria-label="Test area">
      <div>
        <div class="status" id="status">Hold M1 to start!</div>
        <div class="hint" id="flags">M1: up · M2: up</div>
      </div>
    </div>

    <div class="controls">
      <button id="reset">Reset tries</button>

      <div class="metric" id="avgMetric" aria-label="Average timing">
        <div class="label" id="avgLabel">Avg (last 10)</div>
        <div class="value" id="avgValue">—</div>
      </div>

      <div class="metric last" id="lastMetric" aria-label="Last timing">
        <div class="label">Last</div>
        <div class="value" id="lastValue">—</div>
      </div>
    </div>

    <div class="tableWrap" aria-label="Results table">
      <table>
        <thead>
          <tr>
            <th>Try</th>
            <th>Hold (ms)</th>
            <th>Hold (s)</th>
          </tr>
        </thead>
      </table>

      <div class="tbodyScroll">
        <table>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="footer-note">Keeps a rolling window of the last 10 valid tries.</div>
    </div>
  </div>

<script>
(() => {
  const box = document.getElementById('box');
  const status = document.getElementById('status');
  const flags = document.getElementById('flags');
  const tbody = document.getElementById('tbody');

  const avgLabel = document.getElementById('avgLabel');
  const avgValue = document.getElementById('avgValue');
  const lastValue = document.getElementById('lastValue');

  const resetBtn = document.getElementById('reset');

  // State
  let m1Down = false;
  let m2Down = false;
  let measuring = false;
  let startTime = 0;

  /** store last 10 valid tries (ms) */
  const tries = [];

  function now() {
    return (typeof performance !== 'undefined' && performance.now) ? performance.now() : Date.now();
  }

  function updateUI() {
    flags.textContent = `M1: ${m1Down ? 'down' : 'up'} · M2: ${m2Down ? 'down' : 'up'}`;

    if (!m1Down && !measuring) {
      status.textContent = 'Hold M1 to start!';
    } else if (m1Down && !measuring) {
      status.textContent = 'Good. Now hold M2 (right) while still holding M1.';
    } else if (measuring) {
      status.textContent = 'Measuring… keep holding M2, then release M2 (while still holding M1) to record.';
    }
  }

  function renderTable() {
    tbody.innerHTML = '';
    tries.forEach((ms, i) => {
      const tr = document.createElement('tr');
      const tdTry = document.createElement('td');
      const tdMs = document.createElement('td');
      const tdS = document.createElement('td');

      tdTry.textContent = `#${i + 1}`;
      tdMs.textContent = ms.toFixed(2);
      tdS.textContent = (ms / 1000).toFixed(4);

      tr.appendChild(tdTry);
      tr.appendChild(tdMs);
      tr.appendChild(tdS);
      tbody.appendChild(tr);
    });

    if (tries.length) {
      const last = tries[tries.length - 1];
      lastValue.textContent = `${last.toFixed(2)} ms`;
    } else {
      lastValue.textContent = '—';
    }

    if (tries.length) {
      const avg = tries.reduce((a, b) => a + b, 0) / tries.length;
      avgLabel.textContent = `Avg (last ${tries.length})`;
      avgValue.textContent = `${avg.toFixed(2)} ms`;
    } else {
      avgLabel.textContent = 'Avg (last 10)';
      avgValue.textContent = '—';
    }
  }

  function resetAll() {
    m1Down = false;
    m2Down = false;
    measuring = false;
    startTime = 0;
    tries.length = 0;
    renderTable();
    updateUI();
  }

  // Disable the context menu inside the test box (so right-click doesn’t pop the menu)
  box.addEventListener('contextmenu', (e) => e.preventDefault());

  // Keep focus for reliable input
  box.addEventListener('pointerdown', () => box.focus());

  // Mouse down
  box.addEventListener('mousedown', (e) => {
    if (e.button === 0) { // M1
      m1Down = true;
    }
    if (e.button === 2) { // M2
      m2Down = true;

      // Start a try ONLY if M1 is already held and we aren't already measuring
      if (m1Down && !measuring) {
        measuring = true;
        startTime = now();
      }
    }
    updateUI();
  });

  // Mouse up
  box.addEventListener('mouseup', (e) => {
    if (e.button === 0) { // M1 released
      m1Down = false;

      // If M1 is released while measuring, invalidate current try
      if (measuring) {
        measuring = false;
        startTime = 0;
        status.textContent = 'Try invalid: M1 was released before M2. Hold M1 the whole time.';
      }
    }

    if (e.button === 2) { // M2 released
      m2Down = false;

      if (measuring) {
        // Valid only if M1 is STILL held when M2 is released
        if (m1Down) {
          const duration = now() - startTime;
          tries.push(duration);
          // Keep only last 10
          if (tries.length > 10) tries.shift();
          renderTable();
        } else {
          status.textContent = 'Try invalid: M1 must be held when releasing M2.';
        }
        measuring = false;
        startTime = 0;
      }
    }

    updateUI();
  });

  // Safety: if mouse leaves the box while pressed, stop measuring to avoid stuck state
  box.addEventListener('mouseleave', () => {
    if (measuring && (!m2Down || !m1Down)) {
      measuring = false;
      startTime = 0;
    }
    updateUI();
  });

  resetBtn.addEventListener('click', resetAll); 



  
  // Init
  renderTable();
  updateUI();
  box.focus();
})();
</script>
</body>
</html>
